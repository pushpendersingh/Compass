

geoJson=[
         {
             "geometry":{
                "coordinates":[
                   88.34872484207153,
                   22.57145687404986
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Mukund Mandal took refuge in Calcutta in Pyradanga Camp (Rana Ghata site). The refugees from Bangladesh were promised land by Indira Gandhi. They were alotted land in the Andamans. There was a great deal of fear and uncertainty among them.\n",
                "id":"marker-htsjmv7x1",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"campsite",
                "title":"Refugee",
                "tags":"Refugee, Identity, Fear, Survival",
                "images": ['img/all_three_kolkata_refugee_camps.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   88.3245849609375,
                   22.570265549287264
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Post Bangladesh Liberation War (1972), Sugam Mandal's family stayed in Pyradanga Camp (Rana Ghata site) in Calcutta. They were allotted land in the Andamans.",
                "id":"marker-hud8uejq8",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"campsite",
                "title":"Pyradanga Camp ",
                "tags":"Refugee, Identity, Fear, Survival",
                "images": ['img/all_three_kolkata_refugee_camps.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   90.4010009765625,
                   23.74763991365265
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Mukund Mandal was born in 1949 in Bangladesh. He  (with his family and few other families) had to leave Bangladesh in 1972, after the Bangladesh Liberation War. Communal riots took place and Hindus (a minority in Bangladesh) had to flee for their lives.",
                "id":"marker-htsjh54r0",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Childhood Memories",
                "tags":"Survival, Belonging, Partition, Pain",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.62023389339447,
                   11.603807311003994
                ],
                "type":"Point"
             },
             "properties":{
                "description":"In 1972, when the Mandal community arrived they had to stay in the Cellular Jail. They cleared the forests and used timber for building houses. Their struggle for survival continues even today in North Wandoor.",
                "id":"marker-htskbqym2",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"North Wandoor",
                "tags":"Survival, Land, Ecosystem, Food",
                "images": ['img/north_wandoor_both_and_refugee_settlements.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   79.013671875,
                   28.033197847676377
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Ulfa Begum and Nadar Chand from UP were sent to the Cellular Jail before 1942. Nadar Chand is Denise's great great grandfather (maternal side). His great grand father, George Nadar Chand, converted to Christianity.\n",
                "id":"marker-htt0hh6b0",
                "marker-color":"#c5e96f",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"First Batch of Prisoners ",
                "tags":"",
                "images": ['img/first_batch_prisoners.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   76.387939453125,
                   9.96885060854611
                ],
                "type":"Point"
             },
             "properties":{
                "description":"In 1960, Denise's father had to immigrate to Andamans for better livelihood opportunities. ",
                "id":"marker-httcv8su0",
                "marker-color":"#1087bf",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Lack of livelihood opportnities",
                "tags":"",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.73909330368042,
                   11.664341046514533
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Denise's parents met in the Andamans. He was born and brought up here. He lives in Port Blair currently.",
                "id":"marker-httcx2ow1",
                "marker-color":"#c5e96f",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Childhood in Andaman",
                "tags":"Roots, Family, livelihood",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      78.99169921875,
                      28.07198030177986
                   ],
                   [
                      92.73913621902464,
                      11.664341046514533
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-httcyy382",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      76.387939453125,
                      9.985080889293013
                   ],
                   [
                      92.73902893066406,
                      11.664341046514533
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-httd0ogs3",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      90.4010009765625,
                      23.747659554460746
                   ],
                   [
                      88.34874629974364,
                      22.57145687404986
                   ],
                   [
                      92.6202392578125,
                      11.603812565783402
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-htyn13w30",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   96.37760639190674,
                   21.146069714552624
                ],
                "type":"Point"
             },
             "properties":{
                "description":"The Britishers brought the Karen Community to Andamans from Burma in different batches for forestry work. There was military dictatorship in Burma. The Christians of Karen community suffered a lot in Burma because of housing problems. ",
                "id":"marker-hud63dm71",
                "marker-color":"#c5e96f",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Karen Community ",
                "tags":"",
                "images": ['img/Karen_Community.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.90081977844238,
                   12.910368073772396
                ],
                "type":"Point"
             },
             "properties":{
                "description":"The Karen Community were brought as slaves by the Britishers for forestry work (early 1920s). They were given land for housing in Mayabunder. ",
                "id":"marker-hud65fzd2",
                "marker-color":"#c5e96f",
                "marker-size":"small",
                "marker-symbol":"park2",
                "title":"Karen Community in Andamans",
                "tags":"Survival, Land, Livelihood, Immigrants",
                "images": ['img/Karen_Community.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      96.37760639190674,
                      21.14607221615178
                   ],
                   [
                      92.90081977844238,
                      12.910373302582068
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-hud7lh4c3",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   81.6229248046875,
                   21.243939906503265
                ],
                "type":"Point"
             },
             "properties":{
                "description":"In 1974, Sanjay's parents (with few others) decided to move to the Andamans for farming as they suffered from food scarcity in Chattisgarh. ",
                "id":"marker-hud7ucpz4",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Food Scarcity",
                "tags":"",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.61852264404297,
                   11.458827232401926
                ],
                "type":"Point"
             },
             "properties":{
                "description":"The forests were cleared by settlers for cultivation in 1974.  ",
                "id":"marker-hud7z8n25",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"logging",
                "title":"Deforestration in Rutland Islands",
                "tags":"",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      92.61852264404297,
                      11.458835118641215
                   ],
                   [
                      81.6229248046875,
                      21.24394240644596
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-hud83ast6",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   90.08102416992188,
                   23.86696197017416
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Sugam Mandal's family had to leave Bangladesh in 1972, after the Bangladesh Liberation War. Communal riots took place and Hindus (a minority in Bangladesh) had to flee for their lives. ",
                "id":"marker-hud8swtj7",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Post Bangladesh Liberation War",
                "tags":"",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.61955261230469,
                   11.595065848513142
                ],
                "type":"Point"
             },
             "properties":{
                "description":"The Mandals settled in North Wandoor. In 2004, due to Tsunami salt water entered and destroyed their fields. ",
                "id":"marker-hud8v57r9",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Wandoor - Bangladesh Refugee Settlements",
                "tags":"Survival, Land, Food",
                "images": ['img/north_wandoor_both_and_refugee_settlements.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      90.08102416992188,
                      23.867001215710513
                   ],
                   [
                      88.3245849609375,
                      22.570268026064607
                   ],
                   [
                      92.61955261230469,
                      11.595068475985128
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-hud94pmpc",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   90.26229858398436,
                   23.841881641039397
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Dhananjay Mandal's grandfather had to leave Bangladesh in 1972 after East Pakistan became Bangladesh. Communal riots took place and Hindus had to leave Bangladesh.",
                "id":"marker-hud9xy8kd",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Grandfather's Birth Place",
                "tags":"",
                "images": ['img/profile_1.png']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   88.33881139755249,
                   22.571536130217634
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Post Bangladesh Liberation War (1972), Dhananjay Mandal's grandfather stayed in refugee camps in Calcutta. They were alotted land in the Andamans by Indira Gandhi.",
                "id":"marker-huda6bx3e",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"campsite",
                "title":"Refugee Camps",
                "tags":"",
                "images": ['img/all_three_kolkata_refugee_camps.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   92.61197805404663,
                   11.602593454312824
                ],
                "type":"Point"
             },
             "properties":{
                "description":"Dhananjay Mandal was born in Wandoor. He has stayed here all his life.",
                "id":"marker-hudaaotvf",
                "marker-color":"#f86767",
                "marker-size":"small",
                "marker-symbol":"village",
                "title":"Mandals of Wandoor",
                "tags":"Survival, Land, Community",
                "images": ['img/north_wandoor_both_and_refugee_settlements.jpg']
             },
             "type":"Feature"
          },
          {
             "geometry":{
                "coordinates":[
                   [
                      90.26229858398436,
                      23.841881641039397
                   ],
                   [
                      88.33883285522461,
                      22.571536130217634
                   ],
                   [
                      92.61199951171875,
                      11.602635492728048
                   ]
                ],
                "type":"LineString"
             },
             "properties":{
                "description":"",
                "id":"marker-hudahot9g",
                "stroke":"#1f1f1f",
                "stroke-opacity":0.3,
                "stroke-width":2,
                "title":""
             },
             "type":"Feature"
          }
       ];
	
	
	
	
var map = L.mapbox.map('map', 'nandinibhotika.hoac7320').setView([19.456, 94.988], 5);
//map.featureLayer.on('click', function(e) {
  //  map.panTo(e.layer.getLatLng());
//});
// Add custom popups to each using our custom feature properties
map.featureLayer.on('layeradd', function (e) {
    var marker = e.layer;
    var feature = marker.feature;
    var images = feature.properties.images

    var popupContent = '<div id="' + feature.properties.id + '"class="popup">' +
        '<div class="popup-tag-btn"><div class="btn more-btn">Belonging</div><div class="btn more-btn">Partition</div><div class="btn more-btn">Survival</div></div>'+
        '<div class="title">' + feature.properties.title + '</div>' +
        '<div class="story-author">Nandini Bhotika</div>'+
        '<div class="row">'+
        '<div class="image active col-md-offset-3 col-md-6">' +
        '<img src="' + images + '" />' +
        '</div><div class=""></div></div>' +
        '<div class="story-desc-pop">' + feature.properties.description + '</div>' +
        '<div class="btn more-btn">Read More' +
        '</div>' +

    '</div>';


    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent, {
        closeButton: false,
        minWidth: 320
    });
});
var featureLayer = map.featureLayer.setGeoJSON(geoJson);


var geojson = {
    type: 'LineString',
    coordinates: []
},
    start = [90.4010009765625, 23.74763991365265];
geojson.coordinates.push(start.slice());
momentum = [.025, .01429];
for (var i = 0; i < 557; i++) {
    if (start[0] > 88.36878921508789 && start[1] > 22.571377617836507) {
        start[0] -= momentum[0];
        start[1] -= momentum[1];
    } else {
        momentum = [.00899, .0231];
        start[0] += momentum[0];
        start[1] -= momentum[1];
    }
    geojson.coordinates.push(start.slice());

}


var geojsonLayer = L.geoJson(geojson).addTo(map),
    marker = L.circleMarker([0, 0], {
        icon: L.mapbox.marker.icon(),
        radius: 10
    }).addTo(map),
    j = 0;
var pause = true;
tick();

marker.on('click', function (e) {
    if (pause == false) {
        sound.pause();
        pause = true;
    } else {
        sound.play();
        pause = false;
        tick();
    }
});


function tick() {
    // set the marker to be at the same point as one of the segments
    // of the line
    marker.setLatLng(L.latLng(
        geojson.coordinates[j][1],
        geojson.coordinates[j][0]));

    // move to the next point in the line or loop to the first point if
    // j runs off the end of the array
    if (++j < geojson.coordinates.length && pause == false) {
        {
            setTimeout(tick, 100)
        };

    }
}


var sound = new Howl({
    urls: ['audio/marker-audio.mp3'],
    autoplay: false,
    volume: .5,
    buffer: true,
    onend: function () {
        console.log('Finished!');
        j = 0;
        firstPlay = 0;
        tick();
        pause = true;
    }
});


var storyMarkerId;
var boxVisiblity = false;
var firstPlay = 0;
$(document).ready(
    map.featureLayer.on('click', function (e) {

        var title = e.layer.feature.properties.title;
        var description = e.layer.feature.properties.description;
        var image= e.layer.feature.properties.images;
        var selectedMarkerId = e.layer.feature.properties.id;

        if ((selectedMarkerId == "marker-htsjh54r0" || selectedMarkerId == "marker-htsjmv7x1" || selectedMarkerId == "marker-htskbqym2") && (pause === true) && firstPlay === 0) {

            sound.play();
            pause = false;
            tick();
            firstPlay = 1;
        }
        if (typeof storyMarkerId === "undefined") {


            $('#story-box').show('slide', {
                direction: 'right'
            }, 500);

        } else if (storyMarkerId == selectedMarkerId) {
            $('#story-box').toggle('slide', {
                direction: 'right'
            }, 500);
        } else if ($('#story-box').is(":visible")) {} else {
            $('#story-box').toggle('slide', {
                direction: 'right'
            }, 500);
        }
        storyMarkerId = e.layer.feature.properties.id;
        $(".title").text(title);
        $(".story-desc").text(description);
        $(".story-image").attr("src", image);

        
     //   $(".story").text(title);


    })
);





$(function() {
	$( ".progresslabelgreen" ).click(function() {
		 $('.green-tag-dynamic').toggle('slide', {
             direction: 'left'
         }, 500);
		  
		});
	$( ".progresslabelblue" ).click(function() {
		 $('.blue-tag-dynamic').toggle('slide', {
            direction: 'left'
        }, 500);
		  
		});
	$( ".progresslabelred" ).click(function() {
		 $('.red-tag-dynamic').toggle('slide', {
            direction: 'left'
        }, 500);
		  
		});
	$( ".progresslabelyellow" ).click(function() {
		 $('.yellow-tag-dynamic').toggle('slide', {
            direction: 'left'
        }, 500);
		  
		});
});





map.featureLayer.on('click', function (e) {

    // For each point in the map.featureLayer, grab its latitude and longitude
    // values and add them to the line.
    var clickedMarkerColor = e.layer.feature.properties['marker-color'];
    console.log("clor"+ clickedMarkerColor);
    map.featureLayer.eachLayer(function (l) {
        if (l.feature.geometry.type == 'Point' && l.feature.properties['marker-color'] !== clickedMarkerColor) {
            l.setOpacity(.4);
        } else if (l.feature.geometry.type == 'Point') {
            l.setOpacity(1);
        }
    });
});
map.on('click', function (e) {
    $('#story-box').hide('slide', {
        direction: 'right'
    }, 1000);
    map.featureLayer.eachLayer(function (l) {
        if (l.feature.geometry.type == 'Point') {
            l.setOpacity(1);
        }

    });

});


